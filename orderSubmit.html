<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Order Summary</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f7f7f7;
    padding: 20px;
  }
  .container {
    max-width: 700px;
    margin: auto;
    background: white;
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
  }
  h1, h2 {
    text-align: center;
    margin-bottom: 20px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 25px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 12px;
    text-align: left;
  }
  th {
    background: #eee;
  }
  .totals p {
    font-weight: bold;
    font-size: 1.1em;
    text-align: right;
    margin: 5px 0;
  }
  #clientInfo p {
    margin: 5px 0;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>Order Summary</h1>

    <div id="clientInfo"></div>

    <h2>Products Ordered</h2>
    <table id="productsTable">
      <thead>
        <tr>
          <th>Product Name</th>
          <th>Price (R)</th>
          <th>Quantity</th>
          <th>Subtotal (R)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="totals">
      <p>VAT (15%): R<span id="vat">0.00</span></p>
      <p>Total Amount Due: R<span id="total">0.00</span></p>
    </div>
  </div>

  <script>
    // Mask all but last 4 digits of card number
    function maskCardNumber(cardNum) {
      if (!cardNum) return '';
      const len = cardNum.length;
      if (len <= 4) return cardNum;
      return '*'.repeat(len - 4) + cardNum.slice(len - 4);
    }

    // Parse query string params into an object
    function getQueryParams() {
      const search = window.location.search.substring(1);
      const params = {};
      search.split('&').forEach(pair => {
        if (!pair) return;
        const [key, value] = pair.split('=');
        params[decodeURIComponent(key)] = decodeURIComponent(value || '');
      });
      return params;
    }

    // Main function to show order details
    function displayOrder() {
      const data = getQueryParams();

      // Show client info
      const clientDiv = document.getElementById('clientInfo');
      clientDiv.innerHTML = `
        <p><strong>Client Name:</strong> ${data.firstName || ''} ${data.lastName || ''}</p>
        <p><strong>Delivery Address:</strong> ${data.address || ''}</p>
        <p><strong>Name on Card:</strong> ${data.cardName || ''}</p>
        <p><strong>Credit Card Type:</strong> ${data.cardType || ''}</p>
        <p><strong>Credit Card Number:</strong> ${maskCardNumber(data.cardNumber || '')}</p>
        <p><strong>Expiration Date:</strong> ${data.expiryMonth || ''}/${data.expiryYear || ''}</p>
      `;

      const tbody = document.querySelector('#productsTable tbody');
      tbody.innerHTML = '';

      let subtotal = 0;
      let productFound = false;

      // Up to 20 products expected as prodName1, prodPrice1, prodQty1, etc.
      for (let i = 1; i <= 20; i++) {
        const name = data[`prodName${i}`];
        const price = parseFloat(data[`prodPrice${i}`]);
        const qty = parseInt(data[`prodQty${i}`]);

        if (name && !isNaN(price) && !isNaN(qty) && qty > 0) {
          productFound = true;
          const lineTotal = price * qty;
          subtotal += lineTotal;

          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${name}</td>
            <td>R${price.toFixed(2)}</td>
            <td>${qty}</td>
            <td>R${lineTotal.toFixed(2)}</td>
          `;
          tbody.appendChild(tr);
        }
      }

      if (!productFound) {
        tbody.innerHTML = `<tr><td colspan="4">No products ordered.</td></tr>`;
      }

      // Calculate VAT and total
      const vat = subtotal * 0.15;
      const total = subtotal + vat;

      document.getElementById('vat').textContent = vat.toFixed(2);
      document.getElementById('total').textContent = total.toFixed(2);
    }

    window.onload = displayOrder;
  </script>
</body>
</html>

